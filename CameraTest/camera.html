<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>KepcoA</title>
        <style>
            #container {
                margin:0px auto;
                width:80vw;
                height:80vh;
                border: solid 10px #333;
            }
            #video {
                width:80vw;
                height:80vh;
                background-color: #666;
                transform: rotateY(180deg);
            }
        </style>
    </head>
    <body>
        <a href="../index_js.html">목록 보기</a>
        <hr>
        <div id="container">
            <video autoplay="true" id="video"></video>
            <canvas style="display:none;"></canvas> <!-- 캡처를 위한 숨겨진 캔버스 -->
            <button id="captureButton">캡처</button>
        </div>
        <script>
            const video = document.querySelector("#video");
            const canvas = document.querySelector("canvas");
            const captureButton = document.querySelector("#captureButton");
            
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();

            const fulldate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            console.log(fulldate)

            if (navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    video.srcObject = stream;
                })
                .catch(function (err) {
                    console.log("Something went wrong!", err);
                });
            }

            captureButton.onclick = function() {
                // 캔버스 크기를 비디오 크기로 설정
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                // 캔버스에 비디오 화면 캡처
                canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                // 이미지 데이터를 URL로 변환
                const imageDataURL = canvas.toDataURL('image/png');
                // 이미지 다운로드 링크 생성
                const link = document.createElement('a');
                link.href = imageDataURL;
                link.download = `${year}${month}${day}${hours}${minutes}${seconds}.png`;
                // 링크를 클릭하여 다운로드 시작
                link.click();
            };
        </script>
    </body>
</html>